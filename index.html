    <script>
        document.addEventListener("DOMContentLoaded",()=>{
            const p=sessionStorage.getItem("sidebarScroll");if(p)setTimeout(()=>window.scrollTo(0,parseInt(p)),10);
            
            // ÂêØÂä®Ê†∏ÂøÉÈÄªËæë
            initMsgStack(); 
            initWeather();
            initMusic();
            initFloatingText();
            initRibbon();
            
            // Â∞ùËØïËøûÊé•‰∫ëÁ´Ø
            attemptLeanCloudLoad();
        });

        // Êú¨Âú∞ÂÖúÂ∫ïÊï∞ÊçÆ
        const defaultMsgs = [ 
            { date: "2025.06.07", content: "È´òËÄÉÈ°∫Âà©ÔºÅ" }, 
            { date: "2024.12.25", content: "Merry Christmas! üéÑ" }, 
            { date: "2023.11.20", content: "AIË∂äÊù•Ë∂äÂèëËææ‰∫Ü„ÄÇ‚Äî‚ÄîNing" },
            { date: "2023.11.05", content: "ÊàëÊÉ≥Ë¶ÅÂÅö‰∏Ä‰∏™Ëá™Â∑±ÁöÑÁßÅ‰∫∫ÁΩëÁ´ô„ÄÇ‚Äî‚ÄîNing" }
        ];

        // Ê†∏ÂøÉÊï∞ÊçÆÊ∫êÔºöÂÖà‰ªé LocalStorage ËØªÂèñÁî®Êà∑Ëá™Â∑±ÂèëËøáÁöÑÔºåÂÜçÂêàÂπ∂ÈªòËÆ§ÁöÑ
        let globalMsgs = loadLocalMsgs().concat(defaultMsgs);
        let renderStackCards = function() {}; 

        // --- ‰øÆÂ§çÂäüËÉΩÔºöËØªÂèñÊú¨Âú∞ÁºìÂ≠ò ---
        function loadLocalMsgs() {
            try {
                const saved = localStorage.getItem('my_messages');
                return saved ? JSON.parse(saved) : [];
            } catch(e) { return []; }
        }

        // --- ‰øÆÂ§çÂäüËÉΩÔºö‰øùÂ≠òÂà∞Êú¨Âú∞ÁºìÂ≠ò ---
        function saveLocalMsg(content) {
            const d = new Date();
            const dateStr = d.getFullYear() + "." + (d.getMonth()+1).toString().padStart(2,'0') + "." + d.getDate().toString().padStart(2,'0');
            const newMsg = { date: dateStr, content: content };
            
            // Êõ¥Êñ∞ÂÜÖÂ≠òÊï∞ÊçÆ
            globalMsgs.unshift(newMsg);
            
            // Êõ¥Êñ∞Êú¨Âú∞ÁºìÂ≠ò (Âè™Â≠òÂâç20Êù°Ëá™Â∑±ÁöÑÔºåÈò≤Ê≠¢Â§™Èïø)
            const myMsgs = loadLocalMsgs();
            myMsgs.unshift(newMsg);
            localStorage.setItem('my_messages', JSON.stringify(myMsgs.slice(0, 20)));
            
            return newMsg;
        }
        
        function attemptLeanCloudLoad() {
            // ‰Ω†ÁöÑÂõΩÈôÖÁâàÈÖçÁΩÆ
            const LC_APP_ID = "60GMpIJGbEtH3s2GIZZXhi6R-MdYXbMMI";
            const LC_APP_KEY = "7Rl7mxCFErwYvNijpezruXVM";
            const LC_SERVER_URL = "https://60gmpijg.api.lncldglobal.com";
            
            let attempts = 0;
            const checkAV = setInterval(() => {
                attempts++;
                if (window.AV) {
                    clearInterval(checkAV);
                    try {
                        AV.init({ appId: LC_APP_ID, appKey: LC_APP_KEY, serverURL: LC_SERVER_URL });
                        console.log("LeanCloud Connected.");
                        fetchCloudMessages(); 
                    } catch (e) { console.error("LC Init Error:", e); }
                }
                if (attempts > 50) clearInterval(checkAV); // 5ÁßíË∂ÖÊó∂
            }, 100);
        }

        // --- ‰øÆÂ§çÂäüËÉΩÔºöÊãâÂèñ‰∫ëÁ´ØÊï∞ÊçÆ ---
        function fetchCloudMessages() {
            if(!window.AV) return;
            const query = new AV.Query('Message');
            query.descending('createdAt'); 
            query.limit(50); 
            query.find().then((messages) => {
                // Â¶ÇÊûú‰∫ëÁ´ØÊãâÂèñÊàêÂäü
                if(messages && messages.length > 0) {
                    const cloudMsgs = messages.map(m => {
                        const d = m.createdAt || new Date(); // Èò≤Ê≠¢Êó•Êúü‰∏∫Á©∫
                        const dateStr = d.getFullYear() + "." + (d.getMonth()+1).toString().padStart(2,'0') + "." + d.getDate().toString().padStart(2,'0');
                        return { date: dateStr, content: m.get('content') };
                    });
                    // ÂêàÂπ∂Á≠ñÁï•ÔºöÊòæÁ§∫‰∫ëÁ´ØÊúÄÊñ∞ÁöÑÔºåÂ¶ÇÊûú‰∫ëÁ´ØÊ≤°Êï∞ÊçÆÔºåËá≥Â∞ëÊòæÁ§∫Êú¨Âú∞ÁöÑ
                    globalMsgs = cloudMsgs;
                    renderStackCards(); 
                }
            }).catch((e) => {
                console.warn("Cloud fetch failed (likely network blocked). Using local data.", e);
                // ÁΩëÁªúÂ§±Ë¥•Êó∂Ôºå‰∏çÂÅö‰ªª‰ΩïÊìç‰ΩúÔºå‰øùÊåÅÊòæÁ§∫ LocalStorage ÁöÑÊï∞ÊçÆ
            });
        }

        window.addEventListener("beforeunload",()=>sessionStorage.setItem("sidebarScroll",window.scrollY));
        
        function initRibbon() {
            const path = document.getElementById('ribbonPath');
            if(!path) return;
            const pathLen = path.getTotalLength();
            path.style.strokeDasharray = pathLen;
            path.style.strokeDashoffset = pathLen;
            path.getBoundingClientRect(); 
            path.style.visibility = 'visible';
            path.style.opacity = '1';
            const updateScroll = () => {
                const p = window.scrollY / (document.body.scrollHeight - window.innerHeight);
                path.style.strokeDashoffset = pathLen * (1 - p);
            };
            window.addEventListener('scroll', updateScroll);
            updateScroll(); 
        }
        
        function initFloatingText() {
            const layer = document.getElementById('floating-text-canvas');
            for (let i = 0; i < 8; i++) {
                const el = document.createElement('div');
                el.className = 'floating-text-item';
                el.innerText = "·∞îNHY·∞î";
                el.style.left = Math.random() * 100 + '%';
                el.style.top = Math.random() * 100 + '%';
                el.style.animationDuration = (Math.random() * 10 + 10) + 's';
                el.style.fontSize = (Math.random() * 12 + 12) + 'px';
                layer.appendChild(el);
            }
        }

        function initWeather(){const rc=document.getElementById('rainContainer');for(let i=0;i<20;i++){const d=document.createElement('div');d.className='drop';d.style.left=Math.random()*100+'%';d.style.animationDuration=(Math.random()*0.5+0.5)+'s';d.style.animationDelay=Math.random()+'s';rc.appendChild(d);}}
        
        // Music Player
        function initMusic() {
            const audio = document.getElementById('realAudio');
            const playBtn = document.getElementById('playBtn');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const titleEl = document.getElementById('trackTitle');
            const artistEl = document.getElementById('trackArtist');
            const coverEl = document.getElementById('albumArt');
            const bar = document.getElementById('progBar');
            const container = document.getElementById('progContainer');
            const card = document.getElementById('musicCard');

            const playlist = [
                { title: "Lofi Study", artist: "FASSounds", src: "https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3", cover: "https://images.unsplash.com/photo-1516280440614-6697288d5d38?w=200&q=80" },
                { title: "Relaxing Beat", artist: "Coma-Media", src: "https://cdn.pixabay.com/download/audio/2022/03/24/audio_07364d28ea.mp3?filename=relaxing-114996.mp3", cover: "https://images.unsplash.com/photo-1508700115892-45ecd05ae2ad?w=200&q=80" },
                { title: "Summer Night", artist: "Chillmore", src: "https://cdn.pixabay.com/download/audio/2022/10/25/audio_94430f854a.mp3?filename=summer-night-124556.mp3", cover: "https://images.unsplash.com/photo-1493225255756-d9584f8606e9?w=200&q=80" }
            ];
            
            let currentIdx = 0;

            function loadTrack(index) {
                const track = playlist[index];
                titleEl.innerText = track.title;
                artistEl.innerText = track.artist;
                coverEl.style.backgroundImage = `url('${track.cover}')`;
                audio.src = track.src;
            }
            function playTrack() {
                audio.play().then(() => {
                    playBtn.innerText = "‚è∏";
                    card.classList.add('playing');
                }).catch(e => console.error(e));
            }
            function pauseTrack() {
                audio.pause();
                playBtn.innerText = "‚ñ∂";
                card.classList.remove('playing');
            }
            loadTrack(currentIdx);
            playBtn.addEventListener('click', () => { if (audio.paused) playTrack(); else pauseTrack(); });
            nextBtn.addEventListener('click', () => { currentIdx = (currentIdx + 1) % playlist.length; loadTrack(currentIdx); playTrack(); });
            prevBtn.addEventListener('click', () => { currentIdx = (currentIdx - 1 + playlist.length) % playlist.length; loadTrack(currentIdx); playTrack(); });
            audio.addEventListener('timeupdate', () => { if (audio.duration) { const pct = (audio.currentTime / audio.duration) * 100; bar.style.width = pct + "%"; } });
            audio.addEventListener('ended', () => { currentIdx = (currentIdx + 1) % playlist.length; loadTrack(currentIdx); playTrack(); });
            container.addEventListener('click', (e) => { const rect = container.getBoundingClientRect(); const pct = (e.clientX - rect.left) / rect.width; if(audio.duration) { audio.currentTime = pct * audio.duration; } });
        }

        const bD=[{t:"Mr.ÂÆÅ üë®‚Äçüíª",s:110,x:70,y:30},{t:"ÊëÑÂΩ±+ÂêéÊúüüì∏",s:130,x:20,y:60},{t:"Ê≠¶Ê±âÂ∏Ç",s:90,x:50,y:80},{t:"ENFJ",s:80,x:30,y:20},{t:"Â§ßÂ≠¶Áîü",s:95,x:60,y:15},{t:"Áå´Áå´ÔºÅüê±",s:85,x:10,y:40}],cvs=document.getElementById('bubble-canvas'),bs=[];bD.forEach(d=>{const e=document.createElement('div');e.className='bubble';e.innerText=d.t;e.style.width=d.s+'px';e.style.height=d.s+'px';cvs.appendChild(e);bs.push({e:e,bx:d.x,by:d.y,cx:0,cy:0});});let ms={x:-9e3,y:-9e3};window.addEventListener('mousemove',e=>{const r=cvs.getBoundingClientRect();ms.x=e.clientX-r.left;ms.y=e.clientY-r.top;});function ab(){const w=cvs.offsetWidth,h=cvs.offsetHeight;bs.forEach(b=>{const tx=(b.bx/100)*w,ty=(b.by/100)*h,dx=ms.x-tx,dy=ms.y-ty,d=Math.sqrt(dx*dx+dy*dy);if(d<200){const a=Math.atan2(dy,dx),f=(200-d)/200;b.cx+=((-Math.cos(a)*f*150)-b.cx)*.1;b.cy+=((-Math.sin(a)*f*150)-b.cy)*.1;}else{b.cx+=(0-b.cx)*.05;b.cy+=(0-b.cy)*.05;}const t=Date.now()/2e3;b.e.style.left=(tx-b.e.offsetWidth/2)+'px';b.e.style.top=(ty-b.e.offsetHeight/2)+'px';b.e.style.transform=`translate(${b.cx+Math.sin(t+b.bx)*10}px,${b.cy+Math.cos(t+b.by)*10}px)`;});requestAnimationFrame(ab);}ab();
        
        const ws=[{name:"GitHub",icon:"üêô",desc:"Code",url:"https://github.com"},{name:"Dribbble",icon:"üèÄ",desc:"Design",url:"https://dribbble.com"},{name:"ChatGPT",icon:"ü§ñ",desc:"AI",url:"https://chatgpt.com"},{name:"Bilibili",icon:"üì∫",desc:"Video",url:"https://bilibili.com"},{name:"YouTube",icon:"‚ñ∂Ô∏è",desc:"Global",url:"https://youtube.com"},{name:"V2EX",icon:"‚òÅÔ∏è",desc:"Talk",url:"https://v2ex.com"},{name:"Unsplash",icon:"üì∑",desc:"Photo",url:"https://unsplash.com"},{name:"Notion",icon:"üìù",desc:"Note",url:"https://notion.so"},{name:"Figma",icon:"üé®",desc:"UI",url:"https://figma.com"},{name:"Apple",icon:"üçé",desc:"Think",url:"https://apple.com"},{name:"Google",icon:"üîç",desc:"Search",url:"https://google.com"},{name:"X",icon:"üê¶",desc:"News",url:"https://x.com"}];
        const trk=document.getElementById('track');ws.forEach(s=>{const w=document.createElement('div');w.className='web-card-wrapper';w.innerHTML=`<div class="web-card-inner"><div class="card-icon">${s.icon}</div><div><div class="card-title">${s.name}</div><div class="card-desc">${s.desc}</div></div><a href="${s.url}" target="_blank" class="card-btn" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()">Visit</a></div>`;trk.appendChild(w);});
        
        const stg=document.getElementById('carouselStage'),cds=document.querySelectorAll('.web-card-wrapper'),cnt=cds.length;let prg=0,tPrg=0,isD=false,sx=0,st=0,mxr=0;
        
        stg.addEventListener('mousemove',e=>{mxr=e.clientX-stg.getBoundingClientRect().left;});stg.addEventListener('mouseleave',()=>{mxr=-1;});
        stg.addEventListener('mousedown',e=>{isD=true;sx=e.clientX;st=tPrg;stg.style.cursor='grabbing';});
        window.addEventListener('mousemove',e=>{if(!isD)return;const d=e.clientX-sx;tPrg=st-(d/200);});
        window.addEventListener('mouseup',()=>{isD=false;stg.style.cursor='grab';});
        
        stg.addEventListener('touchstart',e=>{isD=true;sx=e.touches[0].clientX;st=tPrg;}, {passive: false});
        stg.addEventListener('touchmove',e=>{if(!isD)return; e.preventDefault(); const d=e.touches[0].clientX-sx;tPrg=st-(d/200);}, {passive: false});
        stg.addEventListener('touchend',()=>{isD=false;});

        function uc(){if(!isD&&mxr!==-1){const w=stg.getBoundingClientRect().width;if(mxr<w*.15&&mxr>0)tPrg-=.03;else if(mxr>w*.85&&mxr<w)tPrg+=.03;}prg+=(tPrg-prg)*.1;cds.forEach((c,i)=>{let o=(i-prg)%cnt;if(o<0)o+=cnt;if(o>cnt/2)o-=cnt;const ao=Math.abs(o);if(ao>5){c.style.display='none';}else{c.style.display='block';const tx=o*180,tz=-(ao*ao)*40,ry=-o*25,zi=100-Math.round(ao*10),op=1-(ao*.15);c.style.zIndex=zi;c.style.opacity=Math.max(op,0);c.style.transform=`translateX(${tx}px) translateZ(${tz}px) rotateY(${ry}deg)`;}});requestAnimationFrame(uc);}uc();
        
        const ems=["‚ú®","üöÄ","üéâ","üî•","üí°","üé®","üíª","üåà","üçé","‚ö°Ô∏è","üì∏"];document.addEventListener('click',e=>{if(e.target.closest('a')||e.target.closest('input')||e.target.closest('.nav-text')||e.target.closest('.halo-container')||e.target.closest('.stack-card')||e.target.closest('.game-card')||e.target.closest('.game-modal')||e.target.closest('.add-msg-btn')||e.target.closest('.control-btn')||e.target.closest('.d-btn'))return;ce(e.clientX,e.clientY);});function ee(x,y){for(let i=0;i<15;i++){setTimeout(()=>{const ox=(Math.random()-.5)*50,oy=(Math.random()-.5)*30;ce(x+ox,y+oy,true);},i*30);}}document.getElementById('navText1').addEventListener('click',e=>ee(e.clientX,e.clientY));document.getElementById('navText2').addEventListener('click',e=>ee(e.clientX,e.clientY));function ce(x,y,iex=false){const e=document.createElement('div');e.className='emoji-particle';e.innerText=ems[Math.floor(Math.random()*ems.length)];e.style.left=x+'px';e.style.top=y+'px';const s=Math.random()*20+20;e.style.fontSize=s+'px';if(iex){const a=Math.random()*Math.PI*2,v=Math.random()*100+50,tx=Math.cos(a)*v,ty=Math.sin(a)*v-100;e.animate([{transform:'translate(0,0) scale(0.5)',opacity:1},{transform:`translate(${tx}px,${ty}px) scale(1.2)`,opacity:0}],{duration:1e3,easing:'cubic-bezier(0.25,0.1,0.25,1)'}).onfinish=()=>e.remove();}else{e.style.animation='emoji-float-up 1s ease-out forwards';setTimeout(()=>e.remove(),1e3);}document.body.appendChild(e);}const sinp=document.getElementById('smartInput'),ssh=document.getElementById('searchShell');sinp.addEventListener('focus',()=>ssh.classList.add('active'));sinp.addEventListener('blur',()=>ssh.classList.remove('active'));sinp.addEventListener('keypress',e=>{if(e.key==='Enter'){let v=sinp.value.trim();if(v)window.open(/^http/.test(v)?v:'https://www.baidu.com/s?wd='+encodeURIComponent(v));}});

        function initMsgStack() {
            const orbBtn = document.getElementById('orbBtn');
            const blogStage = document.getElementById('blogStage');
            const stackContainer = document.getElementById('articleStack');
            const fanZone = document.getElementById('fanZone');
            let isStackOpen = false;
            let state = { scroll: 0, target: 0 };

            renderStackCards = function() {
                stackContainer.innerHTML = '';
                // Ê∏≤ÊüìÊó∂ÂêåÊó∂ÂåÖÂê´ LocalStorage Âíå ÂÖúÂ∫ïÊï∞ÊçÆ (Â¶ÇÊûú‰∫ëÁ´ØÊ≤°ÊãâÂèñÂà∞)
                globalMsgs.forEach((m) => { 
                    const card = document.createElement('div'); 
                    card.className = 'stack-card'; 
                    card.innerHTML = `<div class="stack-date">${m.date}</div><div class="stack-title">${m.content}</div>`; 
                    stackContainer.appendChild(card); 
                });
            }
            renderStackCards();

            function loop() {
                if (!isStackOpen) {
                    const cards = document.querySelectorAll('.stack-card');
                    cards.forEach(c => {
                        if(c.classList.contains('visible')) {
                            c.classList.remove('visible');
                            c.style.transform = `rotateZ(0deg) scale(0.5) translateX(-200px)`;
                            c.style.opacity = 0;
                        }
                    });
                    requestAnimationFrame(loop);
                    return;
                }
                
                state.scroll += (state.target - state.scroll) * 0.1;
                const cards = document.querySelectorAll('.stack-card');
                const total = cards.length;
                
                if(total > 0) {
                    cards.forEach((card, i) => {
                        if(!card.classList.contains('visible')) card.classList.add('visible');
                        let diff = (i - state.scroll) % total;
                        if (diff > total / 2) diff -= total;
                        if (diff < -total / 2) diff += total;

                        if (Math.abs(diff) > 4.5) {
                            card.style.opacity = 0;
                            card.style.pointerEvents = 'none';
                        } else {
                            card.style.pointerEvents = 'auto';
                            const angle = diff * 15; 
                            const scale = 1 - Math.abs(diff) * 0.1;
                            card.style.transform = `rotateZ(${angle}deg) scale(${scale})`;
                            const opacity = 1 - Math.abs(diff) * 0.2;
                            card.style.opacity = Math.max(0, opacity);
                            card.style.zIndex = 100 - Math.round(Math.abs(diff) * 10);
                            if(Math.abs(diff) < 0.5) card.classList.add('focus');
                            else card.classList.remove('focus');
                        }
                    });
                }
                requestAnimationFrame(loop);
            }
            loop();

            orbBtn.addEventListener('click', () => { 
                isStackOpen = !isStackOpen; 
                blogStage.classList.toggle('active', isStackOpen); 
                if(!isStackOpen) state.target = 0;
            });
            
            fanZone.addEventListener('wheel', (e) => {
                if (!isStackOpen) return;
                e.preventDefault();
                state.target += e.deltaY * 0.0025; 
            });

            let startY = 0, startScroll = 0;
            fanZone.addEventListener('touchstart', (e) => {
                if (!isStackOpen) return;
                startY = e.touches[0].clientY; startScroll = state.target;
            }, {passive: false});
            fanZone.addEventListener('touchmove', (e) => {
                if (!isStackOpen) return;
                e.preventDefault(); 
                state.target = startScroll - (e.touches[0].clientY - startY) * 0.01; 
            }, {passive: false});
        }

        function openMsgModal() {
            document.getElementById('gameOverlay').classList.add('active');
            document.getElementById('modalMsg').style.display = 'block';
            document.getElementById('modalMinesweeper').style.display='none';
            document.getElementById('modalTetris').style.display='none';
            document.getElementById('modalSnake').style.display='none';
            document.getElementById('newMsgContent').focus();
        }

        function submitMsg() {
            const inputEl = document.getElementById('newMsgContent');
            const txt = inputEl.value;
            if(!txt.trim()) { alert("Please write something!"); return; }
            
            const btn = document.querySelector('.msg-btn');
            btn.innerText = "ÂèëÂ∏É‰∏≠...";
            btn.disabled = true;

            // --- ‰øÆÂ§çÂäüËÉΩÔºöÊó†ËÆ∫‰∫ëÁ´ØÊòØÂê¶ÊàêÂäüÔºåÂÖàÂ≠òÊú¨Âú∞ ---
            try {
                // Â≠òÂÖ• LocalStorage (ËøôÊ†∑Âà∑Êñ∞Â∞±‰∏çÊÄïÊ≤°‰∫Ü)
                saveLocalMsg(txt);
                
                // ÈáçÊñ∞Ê∏≤ÊüìÂàóË°® (Á´ãÂç≥ÁúãÂà∞ÊïàÊûú)
                renderStackCards();
            } catch(e) { console.error("Local save error", e); }

            // Â∞ùËØïÂ≠òÂÖ•‰∫ëÁ´Ø
            try {
                if (window.AV) {
                    const MessageClass = AV.Object.extend('Message');
                    const message = new MessageClass();
                    message.set('content', txt);
                    message.save().then((savedMsg) => {
                        alert("ÂèëÂ∏ÉÊàêÂäüÔºÅ");
                        resetModal(btn, inputEl);
                    }, (error) => {
                        // Â¶ÇÊûúÂõ†‰∏∫Ê≤°ÊåÇÊ¢ØÂ≠êÂ§±Ë¥•‰∫ÜÔºå‰∏çÊä•ÈîôÔºåËÄåÊòØÂëäËØâÁî®Êà∑‚ÄúÂ∑≤Â≠òÊú¨Âú∞‚Äù
                        console.warn("Cloud save blocked. Persisting locally only.");
                        alert("ÁΩëÁªúËøûÊé•ÂèóÈôêÔºåÁïôË®ÄÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞ÔºÅ(‰ªÖËá™Â∑±ÂèØËßÅ)");
                        resetModal(btn, inputEl);
                    });
                } else {
                    alert("ÂèëÂ∏ÉÊàêÂäüÔºÅ(Êú¨Âú∞Ê®°Âºè)");
                    resetModal(btn, inputEl);
                }
            } catch(e) { 
                alert("ÂèëÂ∏ÉÊàêÂäüÔºÅ(Á¶ªÁ∫øÊ®°Âºè)");
                resetModal(btn, inputEl);
            }
        }

        function resetModal(btn, inputEl) {
            btn.innerText = "ÂèëÂ∏É";
            btn.disabled = false;
            closeGame();
            inputEl.value = ''; 
        }

        let gameInterval = null;
        function closeGame() { document.getElementById('gameOverlay').classList.remove('active'); clearInterval(gameInterval); document.removeEventListener('keydown', controlTetris); document.removeEventListener('keydown', controlSnake); }
        let mines=[], flags=[], msOver=false, safeCells=0;
        function initMinesweeper(){document.getElementById('gameOverlay').classList.add('active');document.getElementById('modalMinesweeper').style.display='block';document.getElementById('modalTetris').style.display='none';document.getElementById('modalSnake').style.display='none';document.getElementById('modalMsg').style.display='none';createMSBoard();}
        function createMSBoard(){const b=document.getElementById('msBoard');b.innerHTML='';mines=Array(100).fill(false);flags=Array(100).fill(false);msOver=false;safeCells=90;document.getElementById('msStatus').innerText="Find 10 Mines";let c=0;while(c<10){let i=Math.floor(Math.random()*100);if(!mines[i]){mines[i]=true;c++;}}for(let i=0;i<100;i++){const c=document.createElement('div');c.className='cell';c.onclick=()=>clickMS(i);c.oncontextmenu=(e)=>{e.preventDefault();flagMS(i);};b.appendChild(c);}}
        function clickMS(i){if(msOver||flags[i])return;const c=document.getElementById('msBoard').children[i];if(mines[i]){c.classList.add('mine');c.innerText='üí£';document.getElementById('msStatus').innerText="Game Over!";msOver=true;revealMSAll();}else{revealMS(i);checkMSWin();}}
        function flagMS(i){if(msOver||document.getElementById('msBoard').children[i].classList.contains('open'))return;flags[i]=!flags[i];const c=document.getElementById('msBoard').children[i];c.classList.toggle('flag');c.innerText=flags[i]?'üö©':'';}
        function revealMS(i){const c=document.getElementById('msBoard').children[i];if(c.classList.contains('open')||flags[i])return;c.classList.add('open');safeCells--;let n=0,r=Math.floor(i/10),col=i%10;for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){const nr=r+dr,nc=col+dc;if(nr>=0&&nr<10&&nc>=0&&nc<10&&mines[nr*10+nc])n++;}if(n>0){c.innerText=n;c.style.color=['','blue','green','red','purple'][n];}else{for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){const nr=r+dr,nc=col+dc;if(nr>=0&&nr<10&&nc>=0&&nc<10)revealMS(nr*10+nc);}}}
        function checkMSWin(){if(safeCells===0){document.getElementById('msStatus').innerText="Victory! üéâ";msOver=true;ee(window.innerWidth/2,window.innerHeight/2);}}
        function revealMSAll(){for(let i=0;i<100;i++)if(mines[i]){const c=document.getElementById('msBoard').children[i];c.classList.add('mine');c.innerText='üí£';}}
        
        // Tetris Logic
        const SHAPES=[[[1,1,1,1]],[[1,1,1],[0,1,0]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1],[1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]],COLORS=['cyan','purple','orange','blue','yellow','red','green'];let tBoard=[],curPiece=null,curX=0,curY=0,tScore=0;
        function initTetris(){document.getElementById('gameOverlay').classList.add('active');document.getElementById('modalMinesweeper').style.display='none';document.getElementById('modalTetris').style.display='block';document.getElementById('modalSnake').style.display='none';document.getElementById('modalMsg').style.display='none';tBoard=Array(20).fill().map(()=>Array(10).fill(0));tScore=0;document.getElementById('tetrisStatus').innerText="Score: 0";spawnPiece();drawTetris();if(gameInterval)clearInterval(gameInterval);gameInterval=setInterval(()=>moveTetris(0,1),500);document.addEventListener('keydown',controlTetris);}
        function drawTetris(){const el=document.getElementById('tetrisBoard');el.innerHTML='';let d=tBoard.map(r=>[...r]);if(curPiece){for(let y=0;y<curPiece.length;y++)for(let x=0;x<curPiece[y].length;x++)if(curPiece[y][x]&&curY+y>=0&&curY+y<20&&curX+x>=0&&curX+x<10)d[curY+y][curX+x]=curPiece.color+1;}for(let y=0;y<20;y++)for(let x=0;x<10;x++){const div=document.createElement('div');div.className='t-cell';if(d[y][x]){div.style.background=COLORS[d[y][x]-1];div.style.border='1px solid rgba(0,0,0,0.2)';}el.appendChild(div);}}
        function spawnPiece(){const id=Math.floor(Math.random()*SHAPES.length);curPiece=SHAPES[id];curPiece.color=id;curX=3;curY=0;if(collision(0,0)){clearInterval(gameInterval);document.getElementById('tetrisStatus').innerText="Game Over! Score: "+tScore;document.removeEventListener('keydown',controlTetris);}}
        function collision(dx,dy,p=curPiece){for(let y=0;y<p.length;y++)for(let x=0;x<p[y].length;x++)if(p[y][x]){let nx=curX+x+dx,ny=curY+y+dy;if(nx<0||nx>=10||ny>=20||(ny>=0&&tBoard[ny][nx]))return true;}return false;}
        function moveTetris(dx,dy){if(!collision(dx,dy)){curX+=dx;curY+=dy;drawTetris();return true;}else if(dy>0){for(let y=0;y<curPiece.length;y++)for(let x=0;x<curPiece[y].length;x++)if(curPiece[y][x]&&curY+y>=0)tBoard[curY+y][curX+x]=curPiece.color+1;for(let y=19;y>=0;y--)if(tBoard[y].every(c=>c!==0)){tBoard.splice(y,1);tBoard.unshift(Array(10).fill(0));tScore+=100;document.getElementById('tetrisStatus').innerText="Score: "+tScore;y++;}spawnPiece();drawTetris();return false;}return false;}
        function rotateTetris(){const r=curPiece[0].map((_,i)=>curPiece.map(row=>row[i]).reverse());r.color=curPiece.color;if(!collision(0,0,r)){curPiece=r;drawTetris();}}
        function controlTetris(e){if(document.getElementById('modalTetris').style.display!=='none'){if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(e.key))e.preventDefault();if(e.key==='ArrowLeft')moveTetris(-1,0);else if(e.key==='ArrowRight')moveTetris(1,0);else if(e.key==='ArrowDown')moveTetris(0,1);else if(e.key==='ArrowUp')rotateTetris();else if(e.key===' '){while(moveTetris(0,1)){}}}}
        
        // Snake Logic
        let snake=[],food={},dir={},nextDir={};
        function initSnake(){document.getElementById('gameOverlay').classList.add('active');document.getElementById('modalMinesweeper').style.display='none';document.getElementById('modalTetris').style.display='none';document.getElementById('modalSnake').style.display='block';document.getElementById('modalMsg').style.display='none';snake=[{x:10,y:10}];dir={x:0,y:0};nextDir={x:0,y:0};tScore=0;document.getElementById('snakeStatus').innerText="Score: 0";placeFood();drawSnake();if(gameInterval)clearInterval(gameInterval);gameInterval=setInterval(updateSnake,150);document.addEventListener('keydown',controlSnake);}
        function placeFood(){food={x:Math.floor(Math.random()*20),y:Math.floor(Math.random()*20)};for(let s of snake)if(s.x===food.x&&s.y===food.y)placeFood();}
        function updateSnake(){dir=nextDir;if(dir.x===0&&dir.y===0)return;const h={x:snake[0].x+dir.x,y:snake[0].y+dir.y};if(h.x<0||h.x>=20||h.y<0||h.y>=20||snake.some(s=>s.x===h.x&&s.y===h.y)){clearInterval(gameInterval);document.getElementById('snakeStatus').innerText="Game Over! Score: "+tScore;return;}snake.unshift(h);if(h.x===food.x&&h.y===food.y){tScore+=10;document.getElementById('snakeStatus').innerText="Score: "+tScore;placeFood();}else{snake.pop();}drawSnake();}
        function drawSnake(){const el=document.getElementById('snakeBoard');el.innerHTML='';for(let y=0;y<20;y++)for(let x=0;x<20;x++){const d=document.createElement('div');d.className='s-cell';if(x===food.x&&y===food.y)d.classList.add('s-food');if(snake.some(s=>s.x===x&&s.y===y))d.classList.add('s-snake');el.appendChild(d);}}
        function controlSnake(e){if(document.getElementById('modalSnake').style.display!=='none'){if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key))e.preventDefault();changeSnakeDirFromKey(e.key);}}
        function changeSnakeDirFromKey(key) {
            if(key==='ArrowUp'&&dir.y===0)nextDir={x:0,y:-1};else if(key==='ArrowDown'&&dir.y===0)nextDir={x:0,y:1};else if(key==='ArrowLeft'&&dir.x===0)nextDir={x:-1,y:0};else if(key==='ArrowRight'&&dir.x===0)nextDir={x:1,y:0};
        }
        function changeSnakeDir(dx, dy) {
            if(dx === 0 && dy === -1 && dir.y === 0) nextDir={x:0,y:-1};
            else if(dx === 0 && dy === 1 && dir.y === 0) nextDir={x:0,y:1};
            else if(dx === -1 && dy === 0 && dir.x === 0) nextDir={x:-1,y:0};
            else if(dx === 1 && dy === 0 && dir.x === 0) nextDir={x:1,y:0};
        }
    </script>